<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>DWA - –î–µ—Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ —Å—Ç—ñ–Ω–∞ –¥–ª—è –≤—Å—ñ—Ö</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <style>
    body {
      transition: background 0.2s, color 0.2s;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    main {
      flex: 1 0 auto;
    }
    .brand-logo {
      font-size: 2.6rem;
      font-weight: 900;
      letter-spacing: 0.04em;
      color: var(--bs-primary);
      display: flex;
      align-items: center;
      gap: 0.4em;
    }
    .brand-desc {
      font-size: 1.1rem;
      color: var(--bs-secondary);
      letter-spacing: 0.02em;
      margin-bottom: 0.5rem;
    }
    .header-controls {
      margin: 0.5rem 0 0 0;
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      justify-content: center;
    }
    .toolbar-btn {
      border: none;
      background: none;
      color: var(--bs-secondary);
      padding: 0 6px;
      font-size: 1.2rem;
      cursor: pointer;
      transition: color 0.2s;
    }
    .toolbar-btn:hover {
      color: var(--bs-primary);
    }
    #content[contenteditable="true"] {
      min-height: 180px;
      outline: none;
      resize: vertical;
      padding: 12px;
      border: 1px solid var(--bs-border-color);
      border-radius: 0.375rem;
      background: var(--bs-body-bg);
      color: var(--bs-body-color);
      transition: background 0.2s, color 0.2s;
    }
    .magnet-link {
      word-break: break-all;
      font-size: 0.95em;
      background: var(--bs-light);
      border-radius: 4px;
      padding: 6px 9px;
      margin-top: 7px;
    }
    .article-actions .btn {
      margin-right: 0.3rem;
      margin-bottom: 0.3rem;
    }
    .nav-section {
      background: var(--bs-light);
      border-bottom: 1px solid var(--bs-border-color);
      margin-bottom: 2.5rem;
    }
    .nav-section .nav-link.active {
      font-weight: bold;
      color: var(--bs-primary) !important;
      border-bottom: 2px solid var(--bs-primary);
    }
    .nav-section .nav-link {
      color: var(--bs-secondary);
      font-size: 1.1rem;
      padding: 1rem 1.2rem;
      transition: color 0.2s, border-bottom 0.2s;
    }
    .nav-section .nav-link:hover {
      color: var(--bs-primary);
    }
    .btn-up {
      position: fixed;
      right: 2vw;
      bottom: 2vw;
      z-index: 2000;
      display: none;
      background: var(--bs-primary);
      color: #fff;
      border-radius: 50%;
      width: 48px;
      height: 48px;
      border: none;
      box-shadow: 0 2px 10px rgba(0,0,0,0.13);
      font-size: 2rem;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    .btn-up.show {
      display: flex;
    }
    @media (max-width: 600px) {
      .brand-logo { font-size: 1.7rem; }
      .brand-desc { font-size: 0.99rem; }
      .nav-section .nav-link { font-size: 1rem; padding: 0.7rem 0.6rem; }
    }
    footer {
      flex-shrink: 0;
      background-color: var(--bs-light);
      padding: 1rem 0 0.5rem 0;
      text-align: center;
      color: var(--bs-secondary);
      border-top: 1px solid var(--bs-border-color);
      font-size: 1rem;
    }
    footer a {
      color: var(--bs-primary);
      text-decoration: none;
    }
    footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body class="bg-light text-dark">
  <!-- Header -->
  <header class="bg-white shadow-sm py-3">
    <div class="container text-center">
      <div class="brand-logo" id="projectAbbr">
        <span class="material-icons" style="font-size:2.1rem;color:#0d6efd;">public</span>
        DWA
      </div>
      <div class="brand-desc" id="projectDesc">–î–µ—Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ —Å—Ç—ñ–Ω–∞ –¥–ª—è –≤—Å—ñ—Ö</div>
      <div class="header-controls">
        <button class="btn btn-outline-primary btn-sm" id="themeBtn" onclick="toggleTheme()">üåô –¢–µ–º–Ω–∞</button>
        <button class="btn btn-outline-primary btn-sm" id="langBtn" onclick="toggleLang()">EN</button>
        <button class="btn btn-outline-primary btn-sm" onclick="exportProfile()" id="exportBtn">–ï–∫—Å–ø–æ—Ä—Ç</button>
        <label class="btn btn-outline-primary btn-sm mb-0" id="importBtn" style="cursor:pointer;">
          <input type="file" id="importProfileInput" style="display:none" onchange="importProfile(event)" />
          –Ü–º–ø–æ—Ä—Ç
        </label>
      </div>
    </div>
  </header>

  <!-- –ù–∞–≤—ñ–≥–∞—Ü—ñ—è -->
  <nav class="nav-section">
    <div class="container">
      <ul class="nav justify-content-center" id="mainNav">
        <li class="nav-item"><a class="nav-link active" href="#editor" id="navEditor">–†–µ–¥–∞–∫—Ç–æ—Ä</a></li>
        <li class="nav-item"><a class="nav-link" href="#posts" id="navPosts">–ü–æ—Å—Ç–∏</a></li>
        <li class="nav-item"><a class="nav-link" href="#view" id="navView">–ü–µ—Ä–µ–≥–ª—è–¥</a></li>
      </ul>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="container pb-4">
    <div class="card shadow-lg mb-4 p-3" id="editor">
      <div class="d-flex align-items-center profile-bar mb-3 flex-wrap gap-2">
        <span id="profile-label" class="fw-semibold me-2">–í–∞—à –ø—Ä–æ—Ñ—ñ–ª—å:</span>
        <span id="profileId" class="text-monospace me-3"></span>
      </div>
      <div>
        <input type="text" id="title" class="form-control mb-2 fs-5 fw-bold" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫" maxlength="100" />
        <input type="text" id="author" class="form-control mb-2" placeholder="–í–∞—à–µ —ñ–º'—è (–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ)" maxlength="40" />
        <div class="mb-2 d-flex gap-2 flex-wrap">
          <button type="button" class="toolbar-btn" onclick="format('bold')" title="–ñ–∏—Ä–Ω–∏–π">
            <span class="material-icons md-20">format_bold</span>
          </button>
          <button type="button" class="toolbar-btn" onclick="format('italic')" title="–ö—É—Ä—Å–∏–≤">
            <span class="material-icons md-20">format_italic</span>
          </button>
          <button type="button" class="toolbar-btn" onclick="format('insertUnorderedList')" title="–°–ø–∏—Å–æ–∫">
            <span class="material-icons md-20">format_list_bulleted</span>
          </button>
          <button type="button" class="toolbar-btn" onclick="format('formatBlock','<blockquote>')" title="–¶–∏—Ç–∞—Ç–∞">
            <span class="material-icons md-20">format_quote</span>
          </button>
        </div>
        <div id="content" contenteditable="true" class="mb-3"></div>
        <button class="btn btn-primary w-100 mb-2" onclick="publish()" id="saveBtn">
          <span class="material-icons md-20 me-1">save</span> –ó–±–µ—Ä–µ–≥—Ç–∏ —É –ø—Ä–æ—Ñ—ñ–ª—ñ
        </button>
      </div>
    </div>

    <div class="card shadow-sm mb-4 p-3" id="posts">
      <h5 class="mb-3" id="myArticlesTitle">–ú–æ—ó –ø–æ—Å—Ç–∏</h5>
      <ul class="list-group mb-0" id="myArticles"></ul>
    </div>

    <div class="card shadow-sm mb-4 p-3" id="view">
      <h5 class="mb-3" id="downloadTitle">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ø–æ—Å—Ç —á–µ—Ä–µ–∑ —Ç–æ—Ä—Ä–µ–Ω—Ç-–º–∞–≥–Ω–µ—Ç</h5>
      <div class="input-group mb-2">
        <input type="text" id="magnet" class="form-control" placeholder="–í—Å—Ç–∞–≤—Ç–µ magnet-–ø–æ—Å–∏–ª–∞–Ω–Ω—è" />
        <button class="btn btn-success" onclick="downloadArticle()" id="downloadBtn">
          <span class="material-icons md-20">cloud_download</span> <span id="downloadBtnText">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏</span>
        </button>
      </div>
      <div id="viewContent"></div>
    </div>
  </main>

  <!-- –ö–Ω–æ–ø–∫–∞ "–í–≥–æ—Ä—É" -->
  <button class="btn-up" id="btnUp" title="–í–≥–æ—Ä—É">
    <span class="material-icons">arrow_upward</span>
  </button>

  <!-- Footer -->
  <footer>
    ¬© 2025 DWA - –î–µ—Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ —Å—Ç—ñ–Ω–∞ –¥–ª—è –≤—Å—ñ—Ö. <a href="https://github.com/" target="_blank" rel="noopener">GitHub</a>
  </footer>

  <!-- WebTorrent CDN -->
  <script src="https://cdn.jsdelivr.net/npm/webtorrent@latest/webtorrent.min.js"></script>
  <script>
    // --- –õ–æ–∫–∞–ª—ñ–∑–∞—Ü—ñ—è ---
    const translations = {
      uk: {
        abbr: "DWA",
        desc: "–î–µ—Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ —Å—Ç—ñ–Ω–∞ –¥–ª—è –≤—Å—ñ—Ö",
        profile: "–í–∞—à –ø—Ä–æ—Ñ—ñ–ª—å:",
        export: "–ï–∫—Å–ø–æ—Ä—Ç",
        import: "–Ü–º–ø–æ—Ä—Ç",
        save: "–ó–±–µ—Ä–µ–≥—Ç–∏ —É –ø—Ä–æ—Ñ—ñ–ª—ñ",
        myArticles: "–ú–æ—ó –ø–æ—Å—Ç–∏",
        downloadTitle: "–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ø–æ—Å—Ç —á–µ—Ä–µ–∑ —Ç–æ—Ä—Ä–µ–Ω—Ç-–º–∞–≥–Ω–µ—Ç",
        download: "–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏",
        enterTitleText: "–í–≤–µ–¥—ñ—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ —ñ —Ç–µ–∫—Å—Ç –ø–æ—Å—Ç—É!",
        view: "–ü–µ—Ä–µ–≥–ª—è–¥",
        edit: "–†–µ–¥–∞–≥—É–≤–∞—Ç–∏",
        del: "–í–∏–¥–∞–ª–∏—Ç–∏",
        torrent: "–¢–æ—Ä—Ä–µ–Ω—Ç",
        magnet: "Magnet-–ø–æ—Å–∏–ª–∞–Ω–Ω—è –¥–ª—è —Ü—å–æ–≥–æ –ø–æ—Å—Ç—É:",
        shareHelp: "–ü–µ—Ä–µ–¥–∞–π—Ç–µ —Ü–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è —ñ–Ω—à–æ–º—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É —á–µ—Ä–µ–∑ —Ç–æ—Ä—Ä–µ–Ω—Ç.",
        importOk: "–ü—Ä–æ—Ñ—ñ–ª—å —ñ–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ!",
        importErr: "–ü–æ–º–∏–ª–∫–∞ —ñ–º–ø–æ—Ä—Ç—É –ø—Ä–æ—Ñ—ñ–ª—é",
        downloadErr: "–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è",
        readErr: "–ü–æ–º–∏–ª–∫–∞ —á–∏—Ç–∞–Ω–Ω—è –ø–æ—Å—Ç—É",
        dark: "üåô –¢–µ–º–Ω–∞",
        light: "‚òÄÔ∏è –°–≤—ñ—Ç–ª–∞",
        namePlaceholder: "–í–∞—à–µ —ñ–º'—è (–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ)",
        titlePlaceholder: "–ó–∞–≥–æ–ª–æ–≤–æ–∫",
        magnetPlaceholder: "–í—Å—Ç–∞–≤—Ç–µ magnet-–ø–æ—Å–∏–ª–∞–Ω–Ω—è",
        copyLink: "–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É",
        linkCopied: "–ü–æ—Å–∏–ª–∞–Ω–Ω—è —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ:",
        navEditor: "–†–µ–¥–∞–∫—Ç–æ—Ä",
        navPosts: "–ü–æ—Å—Ç–∏",
        navView: "–ü–µ—Ä–µ–≥–ª—è–¥",
        up: "–í–≥–æ—Ä—É"
      },
      en: {
        abbr: "DWA",
        desc: "Decentralized Wall for All",
        profile: "Your profile:",
        export: "Export",
        import: "Import",
        save: "Save to profile",
        myArticles: "My posts",
        downloadTitle: "View post via torrent magnet",
        download: "View",
        enterTitleText: "Enter title and post text!",
        view: "View",
        edit: "Edit",
        del: "Delete",
        torrent: "Torrent",
        magnet: "Magnet link for this post:",
        shareHelp: "Share this link to another user to view via torrent.",
        importOk: "Profile imported!",
        importErr: "Import error",
        downloadErr: "Download error",
        readErr: "Read error",
        dark: "üåô Dark",
        light: "‚òÄÔ∏è Light",
        namePlaceholder: "Your name (optional)",
        titlePlaceholder: "Title",
        magnetPlaceholder: "Paste magnet link",
        copyLink: "Copy view link",
        linkCopied: "Link copied:",
        navEditor: "Editor",
        navPosts: "Posts",
        navView: "View",
        up: "Up"
      }
    };
    let lang = localStorage.getItem("tlgph-lang") || "uk";

    function t(key) {
      return translations[lang][key] || key;
    }

    function updateLangUI() {
      document.title = t("abbr") + " - " + t("desc");
      document.getElementById("projectAbbr").innerHTML = `<span class="material-icons" style="font-size:2.1rem;color:#0d6efd;">public</span> DWA`;
      document.getElementById("projectDesc").textContent = t("desc");
      document.getElementById("profile-label").textContent = t("profile");
      document.getElementById("exportBtn").textContent = t("export");
      document.getElementById("importBtn").children[1].textContent = t("import");
      document.getElementById("saveBtn").innerHTML = `<span class="material-icons md-20 me-1">save</span> ${t("save")}`;
      document.getElementById("myArticlesTitle").textContent = t("myArticles");
      document.getElementById("downloadTitle").textContent = t("downloadTitle");
      document.getElementById("downloadBtnText").textContent = t("download");
      document.getElementById("author").placeholder = t("namePlaceholder");
      document.getElementById("title").placeholder = t("titlePlaceholder");
      document.getElementById("magnet").placeholder = t("magnetPlaceholder");
      document.getElementById("langBtn").textContent = lang === "uk" ? "EN" : "UA";
      document.getElementById("navEditor").textContent = t("navEditor");
      document.getElementById("navPosts").textContent = t("navPosts");
      document.getElementById("navView").textContent = t("navView");
      document.getElementById("btnUp").title = t("up");
      renderArticles();
      updateThemeBtn();
      document.querySelector("footer").innerHTML = `¬© 2025 DWA - ${t("desc")}. <a href="https://github.com/" target="_blank" rel="noopener">GitHub</a>`;
    }

    function toggleLang() {
      lang = lang === "uk" ? "en" : "uk";
      localStorage.setItem("tlgph-lang", lang);
      updateLangUI();
    }

    // --- –¢–µ–º–∞ ---
    let theme = localStorage.getItem("tlgph-theme") || "light";
    function setTheme(th) {
      theme = th;
      localStorage.setItem("tlgph-theme", theme);
      if (theme === "dark") {
        document.body.classList.remove("bg-light", "text-dark");
        document.body.classList.add("bg-dark", "text-light");
        document.querySelectorAll(".card").forEach((card) => {
          card.classList.remove("bg-white");
          card.classList.add("bg-secondary", "text-light");
        });
      } else {
        document.body.classList.remove("bg-dark", "text-light");
        document.body.classList.add("bg-light", "text-dark");
        document.querySelectorAll(".card").forEach((card) => {
          card.classList.remove("bg-secondary", "text-light");
          card.classList.add("bg-white");
        });
      }
      updateThemeBtn();
    }
    function toggleTheme() {
      setTheme(theme === "dark" ? "light" : "dark");
    }
    function updateThemeBtn() {
      document.getElementById("themeBtn").textContent =
        theme === "dark" ? t("light") : t("dark");
    }

    // --- –ü—Ä–æ—Ñ—ñ–ª—å ---
    let PROFILE_KEY = "tlgph-profile-id";
    let profileId = localStorage.getItem(PROFILE_KEY);
    if (!profileId) {
      profileId = "id-" + Math.random().toString(36).substr(2, 10);
      localStorage.setItem(PROFILE_KEY, profileId);
    }
    document.getElementById("profileId").textContent = profileId;

    // --- –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è ---
    function format(cmd, val = null) {
      document.execCommand(cmd, false, val);
      document.getElementById("content").focus();
    }

    // --- CRUD –ø–æ—Å—Ç—ñ–≤ ---
    function getArticles() {
      let a = localStorage.getItem("tlgph-articles-" + profileId);
      return a ? JSON.parse(a) : [];
    }
    function saveArticles(arr) {
      localStorage.setItem("tlgph-articles-" + profileId, JSON.stringify(arr));
    }

    function publish() {
      let title = document.getElementById("title").value.trim();
      let author = document.getElementById("author").value.trim();
      let content = document.getElementById("content").innerHTML.trim();
      if (!title || !content.replace(/<[^>]*>?/gm, "").trim()) {
        alert(t("enterTitleText"));
        return;
      }
      let id = "a-" + Math.random().toString(36).substr(2, 9);
      let article = { id, title, author, content, date: Date.now() };
      let arr = getArticles();
      arr.unshift(article);
      saveArticles(arr);
      renderArticles();
      document.getElementById("title").value = "";
      document.getElementById("author").value = "";
      document.getElementById("content").innerHTML = "";
      document.getElementById("viewContent").innerHTML = "";
    }

    function renderArticles() {
      let arr = getArticles();
      let ul = document.getElementById("myArticles");
      ul.innerHTML = "";
      arr.forEach((a) => {
        let li = document.createElement("li");
        li.className =
          "list-group-item d-flex flex-wrap align-items-center justify-content-between";
        li.innerHTML = `<div>
          <b>${a.title}</b> <span class="text-secondary small">${a.author || ""}</span>
        </div>
        <div class="article-actions d-flex flex-wrap">
          <button onclick="viewArticle('${a.id}')" class="btn btn-outline-primary btn-sm">${t(
            "view"
          )}</button>
          <button onclick="editArticle('${a.id}')" class="btn btn-outline-secondary btn-sm">${t(
            "edit"
          )}</button>
          <button onclick="deleteArticle('${a.id}')" class="btn btn-outline-danger btn-sm">${t(
            "del"
          )}</button>
          <button onclick="shareArticleById('${a.id}')" class="btn btn-outline-success btn-sm">${t(
            "torrent"
          )}</button>
        </div>`;
        ul.appendChild(li);
      });
    }

    function viewArticle(id) {
      let arr = getArticles();
      let a = arr.find((x) => x.id === id);
      if (!a) return;
      document.getElementById("viewContent").innerHTML = `<h4>${a.title}</h4>
        <div class="text-secondary mb-2">${a.author || ""}</div>
        <div class="mb-2" style="font-size:1.1em">${a.content}</div>`;
      setActiveNav("navView");
      document.getElementById("view").scrollIntoView({behavior:"smooth"});
    }

    function editArticle(id) {
      let arr = getArticles();
      let a = arr.find((x) => x.id === id);
      if (!a) return;
      document.getElementById("title").value = a.title;
      document.getElementById("author").value = a.author;
      document.getElementById("content").innerHTML = a.content;
      deleteArticle(id, false);
      setActiveNav("navEditor");
      document.getElementById("editor").scrollIntoView({behavior:"smooth"});
    }

    function deleteArticle(id, rerender = true) {
      let arr = getArticles();
      arr = arr.filter((x) => x.id !== id);
      saveArticles(arr);
      if (rerender) renderArticles();
      document.getElementById("viewContent").innerHTML = "";
    }

    // --- –¢–æ—Ä—Ä–µ–Ω—Ç: –ø—É–±–ª—ñ–∫–∞—Ü—ñ—è —Ç–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–æ—Å—Ç—É ---
    let client = new WebTorrent();

    function shareArticleById(id) {
      let arr = getArticles();
      let a = arr.find((x) => x.id === id);
      if (a) shareArticle(a);
    }

    function shareArticle(article) {
      let blob = new Blob([JSON.stringify(article)], { type: "application/json" });
      client.seed(blob, { name: article.title + ".json" }, (torrent) => {
        let magnet = torrent.magnetURI;
        document.getElementById("viewContent").innerHTML = `<b>${t("magnet")}</b>
        <div class="magnet-link">${magnet}</div>
        <div class="text-secondary mt-2" style="font-size:0.95em;">${t(
          "shareHelp"
        )}</div>
        <div class="mt-2">
          <button class="btn btn-outline-primary btn-sm" onclick="copyDirectLink('${magnet}')">
            <span class="material-icons md-20">link</span> ${t("copyLink")}
          </button>
        </div>`;
        setActiveNav("navView");
        document.getElementById("view").scrollIntoView({behavior:"smooth"});
      });
    }

    function copyDirectLink(magnet) {
      let url = location.origin + location.pathname + "#magnet=" + encodeURIComponent(magnet);
      navigator.clipboard.writeText(url);
      alert(t("linkCopied") + "\n" + url);
    }

    function downloadArticle(magnetArg) {
      let magnet = magnetArg || document.getElementById("magnet").value.trim();
      if (!magnet) return;
      document.getElementById("viewContent").innerHTML = '<div class="text-secondary">...</div>';
      client.add(magnet, (torrent) => {
        torrent.files[0].getBlob((err, blob) => {
          if (err) return alert(t("downloadErr"));
          let reader = new FileReader();
          reader.onload = function () {
            try {
              let a = JSON.parse(reader.result);
              document.getElementById("viewContent").innerHTML = `<h4>${a.title}</h4>
                <div class="text-secondary mb-2">${a.author || ""}</div>
                <div class="mb-2" style="font-size:1.1em">${a.content}</div>`;
            } catch (e) {
              alert(t("readErr"));
            }
          };
          reader.readAsText(blob);
        });
      });
      setActiveNav("navView");
    }

    // --- –ï–∫—Å–ø–æ—Ä—Ç/–Ü–º–ø–æ—Ä—Ç –ø—Ä–æ—Ñ—ñ–ª—é ---
    function exportProfile() {
      let arr = getArticles();
      let blob = new Blob([JSON.stringify(arr)], { type: "application/json" });
      let url = URL.createObjectURL(blob);
      let a = document.createElement("a");
      a.href = url;
      a.download = "my-posts-" + profileId + ".json";
      a.click();
      setTimeout(() => URL.revokeObjectURL(url), 2000);
    }

    function importProfile(event) {
      let file = event.target.files[0];
      if (!file) return;
      let reader = new FileReader();
      reader.onload = function () {
        try {
          let arr = JSON.parse(reader.result);
          if (!Array.isArray(arr)) throw "Format error";
          saveArticles(arr);
          renderArticles();
          alert(t("importOk"));
        } catch (e) {
          alert(t("importErr"));
        }
      };
      reader.readAsText(file);
    }

    // --- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –ø–µ—Ä–µ–≥–ª—è–¥ –ø–æ magnet-–ø–æ—Å–∏–ª–∞–Ω–Ω—é —É URL ---
    function getMagnetFromUrl() {
      let hash = decodeURIComponent(window.location.hash);
      let search = decodeURIComponent(window.location.search);
      let m = hash.match(/magnet:\?xt=urn:btih:[A-Za-z0-9]+[^\s]*/);
      if (m) return m[0];
      m = search.match(/magnet:\?xt=urn:btih:[A-Za-z0-9]+[^\s]*/);
      if (m) return m[0];
      let params = new URLSearchParams(window.location.search + window.location.hash.replace("#", "&"));
      if (params.has("magnet")) return params.get("magnet");
      return null;
    }

    // --- –ù–∞–≤—ñ–≥–∞—Ü—ñ—è –ø–æ –≤–∫–ª–∞–¥–∫–∞—Ö ---
    function setActiveNav(id) {
      ["navEditor", "navPosts", "navView"].forEach(function(navId) {
        document.getElementById(navId).classList.remove("active");
      });
      document.getElementById(id).classList.add("active");
    }
    document.getElementById("navEditor").onclick = function() {
      setActiveNav("navEditor");
      document.getElementById("editor").scrollIntoView({behavior:"smooth"});
    };
    document.getElementById("navPosts").onclick = function() {
      setActiveNav("navPosts");
      document.getElementById("posts").scrollIntoView({behavior:"smooth"});
    };
    document.getElementById("navView").onclick = function() {
      setActiveNav("navView");
      document.getElementById("view").scrollIntoView({behavior:"smooth"});
    };

    // --- –ö–Ω–æ–ø–∫–∞ "–í–≥–æ—Ä—É" ---
    const btnUp = document.getElementById("btnUp");
    window.addEventListener("scroll", function() {
      if(window.scrollY > 300) btnUp.classList.add("show");
      else btnUp.classList.remove("show");
    });
    btnUp.onclick = function() {
      window.scrollTo({top:0,behavior:"smooth"});
    };

    window.addEventListener("DOMContentLoaded", function () {
      setTheme(theme);
      updateLangUI();
      const magnet = getMagnetFromUrl();
      if (magnet) {
        document.getElementById("magnet").value = magnet;
        downloadArticle(magnet);
      }
    });

    document.addEventListener("keydown", (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key === "Enter") publish();
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
